<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>Flask + SmartEditor2</title>
  <script src="{{ url_for('static', filename='smarteditor2/js/service/HuskyEZCreator.js') }}" charset="utf-8"></script>
  <style>
    #ir1 {
      display: none;
    }
  </style>
</head>
<body>
  <h2>âœï¸ ìŠ¤ë§ˆíŠ¸ì—ë””í„° ì…ë ¥</h2>

  <form id="editorForm" method="post" action="/api/form_editor/submit">
    <textarea id="ir1" name="ir1" rows="10" cols="100"></textarea>
    <br>
    <button type="button" onclick="submitEditorForm()">ì œì¶œ</button>
  </form>

  <script>
    var oEditors = [];

    nhn.husky.EZCreator.createInIFrame({
      oAppRef: oEditors,
      elPlaceHolder: "ir1",
      sSkinURI: "{{ url_for('static', filename='smarteditor2/SmartEditor2Skin.html') }}",
      fCreator: "createSEditor2",
      htParams: {
        bUseToolbar: true,
        bUseVerticalResizer: true,
        bUseModeChanger: true
      },
      fOnAppLoad: function () {
        oEditors.getById["ir1"].exec("PASTE_HTML", [
          `<div style="border:1px solid #aaa;padding:10px;">
            <h3>ğŸ“Œ ì‹ ì²­ì„œ</h3>
            <p>ì´ë¦„: <input type='text' id='nameInput'></p>
            <p>ì—°ë½ì²˜: <input type='text' id='phoneInput'></p>
            <p>ë‚´ìš©: <textarea id='messageInput' rows='3'></textarea></p>
          </div>`
        ]);
      }
    });

    function submitEditorForm() {
      // (1) ìš°ì„ , ì—ë””í„° ë‚´ìš©ì„ ì—…ë°ì´íŠ¸í•˜ì—¬ hidden textarea(#ir1)ì— í˜„ì¬ ë‚´ìš©ì„ ë™ê¸°í™”í•©ë‹ˆë‹¤.
      oEditors.getById["ir1"].exec("UPDATE_CONTENTS_FIELD", []);
      // ìœ„ ì½”ë“œì—ì„œ PASTE_HTMLì•ˆì— input dom dataì²˜ë¦¬ê°€ ì•ˆë¨ ã… .ã… 
      let content = document.getElementById("ir1").value;
      alert(content);

      // SmartEditor2 ì¸ìŠ¤í„´ìŠ¤("ir1")ì˜ ë‚´ë¶€ IFrame ìš”ì†Œì— ì ‘ê·¼
      var editorInstance = oEditors.getById["ir1"];
      var editorFrame = editorInstance._iframe;  // SmartEditor2ëŠ” ë‚´ë¶€ì ìœ¼ë¡œ _iframe í”„ë¡œí¼í‹°ì— IFrame ê°ì²´ë¥¼ ë³´ê´€í•©ë‹ˆë‹¤.
      if (!editorFrame) {
        console.error("ì—ë””í„° IFrameì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
      } else {
        var iframeDoc = editorFrame.contentDocument || editorFrame.contentWindow.document;
        if (!iframeDoc) {
          console.error("ì—ë””í„° IFrameì˜ documentì— ì ‘ê·¼í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
        } else {
          // live DOMì—ì„œ idê°€ nameInputì¸ <input> ìš”ì†Œì˜ í˜„ì¬ valueë¥¼ ê°€ì ¸ì˜´
          var nameInput = iframeDoc.getElementById("nameInput");
          var nameValue = nameInput ? nameInput.value : "";
          console.log("ì´ë¦„ ì…ë ¥ê°’:", nameValue);
        }
      }
      //document.getElementById("editorForm").submit();
    }

    function submitEditorForm_old() {
      // (1) ìš°ì„ , ì—ë””í„° ë‚´ìš©ì„ ì—…ë°ì´íŠ¸í•˜ì—¬ hidden textarea(#ir1)ì— í˜„ì¬ ë‚´ìš©ì„ ë™ê¸°í™”í•©ë‹ˆë‹¤.
      oEditors.getById["ir1"].exec("UPDATE_CONTENTS_FIELD", []);

      // (2) SmartEditor2 ì¸ìŠ¤í„´ìŠ¤ì˜ ë‚´ë¶€ IFrame ìš”ì†Œì— ì ‘ê·¼í•©ë‹ˆë‹¤.
      var editorInstance = oEditors.getById["ir1"];
      // _iframe í”„ë¡œí¼í‹°ë¡œ IFrame ìš”ì†Œë¥¼ ê°€ì ¸ì˜µë‹ˆë‹¤.
      var editorFrame = editorInstance._iframe;
      if (!editorFrame) {
        console.error("âŒ ì—ë””í„° IFrameì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
        return;
      }
      var iframeDoc = editorFrame.contentDocument || editorFrame.contentWindow.document;
      if (!iframeDoc) {
        console.error("âŒ ì—ë””í„° IFrameì˜ documentì— ì ‘ê·¼í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
        return;
      }

      // (3) IFrame ë‚´ë¶€ì˜ ëª¨ë“  <input> ìš”ì†Œì— ëŒ€í•´ í˜„ì¬ valueë¥¼ í•´ë‹¹ attributeì— ì—…ë°ì´íŠ¸í•©ë‹ˆë‹¤.
      var inputs = iframeDoc.querySelectorAll("input");
      inputs.forEach(function(input) {
        // input.valueëŠ” ì‚¬ìš©ìê°€ ì…ë ¥í•œ í˜„ì¬ ê°’ì´ê³ , ì´ê²ƒì„ value attributeì— ì„¤ì •í•©ë‹ˆë‹¤.
        input.setAttribute("value", input.value);
      });

      // (4) IFrame ë‚´ë¶€ì˜ ëª¨ë“  <textarea> ìš”ì†Œë„ textContentë¥¼ ì—…ë°ì´íŠ¸í•©ë‹ˆë‹¤.
      var textareas = iframeDoc.querySelectorAll("textarea");
      textareas.forEach(function(textarea) {
        // <textarea>ì˜ ê²½ìš°, ë‚´ìš©ì€ textContentë¡œ ê´€ë¦¬ë©ë‹ˆë‹¤.
        textarea.textContent = textarea.value;
      });

      // (5) ì—…ë°ì´íŠ¸ëœ HTMLì„ ê°€ì ¸ì˜µë‹ˆë‹¤.
      // getIR()ì€ IFrame ë‚´ë¶€ì˜ body.innerHTMLì„ ë°˜í™˜í•©ë‹ˆë‹¤.
      var editorHTML = editorInstance.getIR();
      alert(editorHTML);

      // (6) í•„ìš”í•œ ê²½ìš° ì„ì‹œ DOM ê°ì²´ì— ë‹´ì•„ ê°’ì„ ì¶”ì¶œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
      // ì˜ˆ: í¼ ìš”ì†Œì˜ ê°’ì„ ë‹¤ì‹œ ì½ê³  ì‹¶ë‹¤ë©´ ì•„ë˜ì™€ ê°™ì´ ì§„í–‰í•©ë‹ˆë‹¤.
      var temp = document.createElement("div");
      temp.innerHTML = editorHTML;
      var name = temp.querySelector("#nameInput") ? temp.querySelector("#nameInput").value : "";
      var phone = temp.querySelector("#phoneInput") ? temp.querySelector("#phoneInput").value : "";
      var message = temp.querySelector("#messageInput") ? temp.querySelector("#messageInput").value : "";
      alert(`ì´ë¦„: ${name}\nì—°ë½ì²˜: ${phone}\në‚´ìš©: ${message}`);

      // (7) ë§Œì•½ ì‚¬ìš©ì ì…ë ¥ ê°’ë“¤ì„ ë‹¤ì‹œ í¬í•¨í•˜ëŠ” ìƒˆë¡œìš´ HTMLì„ ë§Œë“¤ê³  ì‹¶ë‹¤ë©´:
      var updatedHTML = `
        <div style="border:1px solid #aaa; padding:10px;">
          <h3>ğŸ“Œ ì‹ ì²­ì„œ</h3>
          <p>ì´ë¦„: ${name}</p>
          <p>ì—°ë½ì²˜: ${phone}</p>
          <p>ë‚´ìš©: ${message.replace(/\n/g, "<br>")}</p>
        </div>
      `;

      // (8) ìƒˆë¡œìš´ HTMLë¡œ ì—ë””í„° ì—…ë°ì´íŠ¸ í›„ í¼ ì œì¶œ
      editorInstance.exec("SET_IR", [updatedHTML]);
      editorInstance.exec("UPDATE_CONTENTS_FIELD", []);
      document.getElementById("editorForm").submit();
    }
  </script>
</body>
</html>
